<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrustChain JavaScript SDK - Browser Example</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .header {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .tool-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .tool-section h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        input, select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px;
        }
        .output {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .stat-box {
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        .signature-info {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }
        .ws-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
        }
        .ws-connected { background: #d4edda; color: #155724; }
        .ws-disconnected { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîó TrustChain JavaScript SDK</h1>
        <p>Browser demonstration of cryptographically verified tool execution</p>
    </div>

    <div id="ws-status" class="ws-status ws-disconnected">WebSocket: Disconnected</div>

    <div class="container">
        <h2>üîß Connection Setup</h2>
        <div>
            <label>Server URL:</label>
            <input type="text" id="serverUrl" value="http://localhost:8000" style="width: 300px;">
            <button onclick="connectToServer()">Connect</button>
            <button onclick="healthCheck()">Health Check</button>
        </div>
        <div id="connectionStatus" class="status info">Not connected</div>
    </div>

    <div class="container">
        <h2>üìä Server Statistics</h2>
        <button onclick="loadStats()">Refresh Stats</button>
        <div id="stats" class="stats"></div>
    </div>

    <div class="container">
        <h2>üõ†Ô∏è Available Tools</h2>
        <button onclick="loadTools()">Load Tools</button>
        <div id="toolsList"></div>
    </div>

    <div class="container">
        <h2>üß™ Tool Testing</h2>
        
        <div class="tool-section">
            <h3>Weather API</h3>
            <div>
                <input type="text" id="weatherCity" placeholder="City name" value="London">
                <select id="weatherUnits">
                    <option value="celsius">Celsius</option>
                    <option value="fahrenheit">Fahrenheit</option>
                </select>
                <button onclick="testWeatherTool()">Get Weather</button>
            </div>
            <div id="weatherOutput" class="output"></div>
        </div>

        <div class="tool-section">
            <h3>Calculator</h3>
            <div>
                <input type="number" id="calcA" placeholder="Number A" value="10">
                <select id="calcOperation">
                    <option value="add">Add</option>
                    <option value="subtract">Subtract</option>
                    <option value="multiply">Multiply</option>
                    <option value="divide">Divide</option>
                    <option value="power">Power</option>
                    <option value="modulo">Modulo</option>
                </select>
                <input type="number" id="calcB" placeholder="Number B" value="5">
                <button onclick="testCalculatorTool()">Calculate</button>
            </div>
            <div id="calculatorOutput" class="output"></div>
        </div>

        <div class="tool-section">
            <h3>Text Processor</h3>
            <div>
                <input type="text" id="processText" placeholder="Text to process" value="Hello World">
                <select id="textOperation">
                    <option value="upper">UPPERCASE</option>
                    <option value="lower">lowercase</option>
                    <option value="reverse">Reverse</option>
                    <option value="capitalize">Capitalize</option>
                    <option value="title">Title Case</option>
                    <option value="length">Length</option>
                    <option value="words">Word Count</option>
                </select>
                <button onclick="testTextTool()">Process</button>
            </div>
            <div id="textOutput" class="output"></div>
        </div>

        <div class="tool-section">
            <h3>Currency Converter</h3>
            <div>
                <input type="number" id="currencyAmount" placeholder="Amount" value="100">
                <select id="fromCurrency">
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                    <option value="GBP">GBP</option>
                    <option value="JPY">JPY</option>
                    <option value="CAD">CAD</option>
                </select>
                <span>to</span>
                <select id="toCurrency">
                    <option value="EUR">EUR</option>
                    <option value="USD">USD</option>
                    <option value="GBP">GBP</option>
                    <option value="JPY">JPY</option>
                    <option value="CAD">CAD</option>
                </select>
                <button onclick="testCurrencyTool()">Convert</button>
            </div>
            <div id="currencyOutput" class="output"></div>
        </div>
    </div>

    <div class="container">
        <h2>üìà Client Statistics</h2>
        <button onclick="showClientStats()">Show Stats</button>
        <div id="clientStats" class="output"></div>
    </div>

    <div class="container">
        <h2>üîå WebSocket Activity</h2>
        <button onclick="connectWebSocket()">Connect WebSocket</button>
        <button onclick="disconnectWebSocket()">Disconnect</button>
        <div id="wsActivity" class="output" style="max-height: 150px;"></div>
    </div>

    <!-- Load TrustChain SDK -->
    <script src="../trustchain.js"></script>
    
    <script>
        // Global variables
        let client = null;
        
        // Initialize client
        function initClient() {
            const serverUrl = document.getElementById('serverUrl').value;
            client = new TrustChain.TrustChainClient(serverUrl, {
                timeout: 10000,
                retries: 3,
                autoVerify: true
            });
        }
        
        // Connection functions
        async function connectToServer() {
            try {
                initClient();
                const health = await client.healthCheck();
                document.getElementById('connectionStatus').innerHTML = 
                    `‚úÖ Connected to TrustChain server (v${health.version})`;
                document.getElementById('connectionStatus').className = 'status success';
                
                // Auto-load tools and stats
                await loadTools();
                await loadStats();
            } catch (error) {
                document.getElementById('connectionStatus').innerHTML = 
                    `‚ùå Connection failed: ${error.message}`;
                document.getElementById('connectionStatus').className = 'status error';
            }
        }
        
        async function healthCheck() {
            if (!client) {
                initClient();
            }
            
            try {
                const health = await client.healthCheck();
                document.getElementById('connectionStatus').innerHTML = 
                    `‚úÖ Health check passed - Server version: ${health.version}`;
                document.getElementById('connectionStatus').className = 'status success';
            } catch (error) {
                document.getElementById('connectionStatus').innerHTML = 
                    `‚ùå Health check failed: ${error.message}`;
                document.getElementById('connectionStatus').className = 'status error';
            }
        }
        
        // Statistics functions
        async function loadStats() {
            if (!client) return;
            
            try {
                const serverStats = await client.getServerStats();
                const clientStats = client.getClientStats();
                
                document.getElementById('stats').innerHTML = `
                    <div class="stat-box">
                        <strong>Server Tools</strong><br>
                        ${serverStats.total_tools}
                    </div>
                    <div class="stat-box">
                        <strong>Total Calls</strong><br>
                        ${serverStats.total_calls}
                    </div>
                    <div class="stat-box">
                        <strong>Cache Size</strong><br>
                        ${serverStats.cache_size}
                    </div>
                    <div class="stat-box">
                        <strong>Uptime</strong><br>
                        ${Math.round(serverStats.uptime_seconds)}s
                    </div>
                    <div class="stat-box">
                        <strong>Client Success Rate</strong><br>
                        ${clientStats.successRate}
                    </div>
                    <div class="stat-box">
                        <strong>Verification Rate</strong><br>
                        ${clientStats.verificationRate}
                    </div>
                `;
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }
        
        async function loadTools() {
            if (!client) return;
            
            try {
                const tools = await client.getTools();
                const toolsList = tools.map(tool => `
                    <div class="tool-section">
                        <h4>${tool.name}</h4>
                        <p>${tool.description}</p>
                        <small>Type: ${tool.is_async ? 'Async' : 'Sync'}</small>
                    </div>
                `).join('');
                
                document.getElementById('toolsList').innerHTML = toolsList;
            } catch (error) {
                console.error('Failed to load tools:', error);
            }
        }
        
        // Tool testing functions
        async function testWeatherTool() {
            if (!client) return;
            
            const city = document.getElementById('weatherCity').value;
            const units = document.getElementById('weatherUnits').value;
            
            try {
                const response = await client.callTool('weather_api', { city, units });
                
                document.getElementById('weatherOutput').innerHTML = `
                    <strong>Weather for ${response.data.city}:</strong><br>
                    Temperature: ${response.data.temperature}¬∞${units === 'celsius' ? 'C' : 'F'}<br>
                    Condition: ${response.data.condition}<br>
                    Humidity: ${response.data.humidity}%<br>
                    Wind: ${response.data.wind_speed} km/h ${response.data.wind_direction}<br>
                    <div class="signature-info">
                        ‚úÖ Verified: ${response.is_verified}<br>
                        Signature: ${response.getSignaturePreview()}<br>
                        Timestamp: ${response.getFormattedTimestamp()}
                    </div>
                `;
            } catch (error) {
                document.getElementById('weatherOutput').innerHTML = `‚ùå Error: ${error.message}`;
            }
        }
        
        async function testCalculatorTool() {
            if (!client) return;
            
            const a = parseFloat(document.getElementById('calcA').value);
            const b = parseFloat(document.getElementById('calcB').value);
            const operation = document.getElementById('calcOperation').value;
            
            try {
                const response = await client.callTool('calculator', { operation, a, b });
                
                document.getElementById('calculatorOutput').innerHTML = `
                    <strong>Calculation Result:</strong><br>
                    ${response.data.calculation}<br>
                    Result: ${response.data.result}<br>
                    <div class="signature-info">
                        ‚úÖ Verified: ${response.is_verified}<br>
                        Signature: ${response.getSignaturePreview()}
                    </div>
                `;
            } catch (error) {
                document.getElementById('calculatorOutput').innerHTML = `‚ùå Error: ${error.message}`;
            }
        }
        
        async function testTextTool() {
            if (!client) return;
            
            const text = document.getElementById('processText').value;
            const operation = document.getElementById('textOperation').value;
            
            try {
                const response = await client.callTool('text_processor', { text, operation });
                
                document.getElementById('textOutput').innerHTML = `
                    <strong>Text Processing Result:</strong><br>
                    Original: "${response.data.original_text}"<br>
                    Operation: ${response.data.operation}<br>
                    Result: ${JSON.stringify(response.data.result)}<br>
                    Characters: ${response.data.character_count}, Words: ${response.data.word_count}<br>
                    <div class="signature-info">
                        ‚úÖ Verified: ${response.is_verified}<br>
                        Signature: ${response.getSignaturePreview()}
                    </div>
                `;
            } catch (error) {
                document.getElementById('textOutput').innerHTML = `‚ùå Error: ${error.message}`;
            }
        }
        
        async function testCurrencyTool() {
            if (!client) return;
            
            const amount = parseFloat(document.getElementById('currencyAmount').value);
            const from_currency = document.getElementById('fromCurrency').value;
            const to_currency = document.getElementById('toCurrency').value;
            
            try {
                const response = await client.callTool('currency_converter', { 
                    amount, from_currency, to_currency 
                });
                
                document.getElementById('currencyOutput').innerHTML = `
                    <strong>Currency Conversion:</strong><br>
                    ${response.data.conversion}<br>
                    Exchange Rate: ${response.data.exchange_rate}<br>
                    <div class="signature-info">
                        ‚úÖ Verified: ${response.is_verified}<br>
                        Signature: ${response.getSignaturePreview()}
                    </div>
                `;
            } catch (error) {
                document.getElementById('currencyOutput').innerHTML = `‚ùå Error: ${error.message}`;
            }
        }
        
        // Client statistics
        function showClientStats() {
            if (!client) return;
            
            const stats = client.getClientStats();
            document.getElementById('clientStats').innerHTML = `
                Total Calls: ${stats.totalCalls}<br>
                Successful: ${stats.successfulCalls}<br>
                Failed: ${stats.failedCalls}<br>
                Success Rate: ${stats.successRate}<br>
                Verification Success: ${stats.verificationSuccess}<br>
                Verification Failed: ${stats.verificationFailed}<br>
                Verification Rate: ${stats.verificationRate}
            `;
        }
        
        // WebSocket functions
        async function connectWebSocket() {
            if (!client) return;
            
            try {
                await client.connectWebSocket((message) => {
                    const activity = document.getElementById('wsActivity');
                    const timestamp = new Date().toLocaleTimeString();
                    activity.innerHTML = `[${timestamp}] ${JSON.stringify(message)}<br>` + activity.innerHTML;
                });
                
                document.getElementById('ws-status').textContent = 'WebSocket: Connected';
                document.getElementById('ws-status').className = 'ws-status ws-connected';
            } catch (error) {
                console.error('WebSocket connection failed:', error);
            }
        }
        
        function disconnectWebSocket() {
            if (!client) return;
            
            client.disconnectWebSocket();
            document.getElementById('ws-status').textContent = 'WebSocket: Disconnected';
            document.getElementById('ws-status').className = 'ws-status ws-disconnected';
        }
        
        // Auto-refresh stats every 10 seconds
        setInterval(() => {
            if (client) {
                loadStats();
            }
        }, 10000);
        
        // Initialize on page load
        window.onload = function() {
            document.getElementById('connectionStatus').innerHTML = 
                'üîå Ready to connect - Click "Connect" to start';
        };
    </script>
</body>
</html> 